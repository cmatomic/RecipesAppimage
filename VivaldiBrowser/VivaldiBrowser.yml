app: vivaldi-stable
binpatch: true

ingredients:
   packages: 
  dist:  xenial
  sources:
    - deb "http://archive.ubuntu.com/ubuntu/  xenial main universe"
  script:
    #-  wget -U firefox -r -nd --no-parent -A 'vivaldi-stable_3.*_amd64.deb' https://downloads.vivaldi.com/stable/
   -   wget 'https://downloads.vivaldi.com/stable/vivaldi-stable_3.4.2066.76-1_amd64.deb'
script:
  - cat > AppRun <<\EOF
  - #!/bin/bash
  - HERE=$(dirname $(readlink -f "${0}"))
  - export PATH="$HERE/usr/sbin:$HERE/usr/bin:$HERE/sbin:$HERE/bin:$PATH"
  - export LD_LIBRARY_PATH="$HERE/lib:$HERE/usr/lib:$HERE/lib/x86_64-linux-gnu:$HERE/usr/lib/x86_64-linux-gnu:$LD_LIBRARY_PATH"
  - export LD_LIBRARY_PATH="$HERE/usr/lib/x86_64-linux-gnu/mesa:$HERE/usr/lib/x86_64-linux-gnu/mesa-egl:$LD_LIBRARY_PATH"
  - export LD_LIBRARY_PATH="$HERE/lib/x86_64-linux-gnu:$HERE/usr/lib:$HERE/usr/lib/x86_64-linux-gnu:$HERE/usr/lib/x86_64-linux-gnu/mesa:$HERE/usr/lib/x86_64-linux-gnu/mesa-egl:$HERE/usr/lib/x86_64-linux-gnu/pulseaudio:$HERE/usr/lib/x86_64-linux-gnu/samba:$LD_LIBRARY_PATH"
  - export LD_LIBRARY_PATH="$HERE/usr/local/samba/bin/:/usr/local/samba/sbin/:$LD_LIBRARY_PATH"
  - export LD_LIBRARY_PATH=$HERE_LIBRARY_PATH:$LD_LIBRARY_PATH
  - "${HERE}"/opt/vivaldi/vivaldi$@
  - EOF
  - chmod a+x AppRun
  - cp ./opt/vivaldi/product_logo_256_dev.png ./usr/share/icons/hicolor/256x256/
  - mv ./usr/share/icons/hicolor/256x256/product_logo_256_dev.png ./usr/share/icons/hicolor/256x256/vivaldi-stable.png
  - cp ./usr/share/icons/hicolor/256x256/vivaldi-stable.png .
